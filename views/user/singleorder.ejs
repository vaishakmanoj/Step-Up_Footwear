<%-include('../user/layout/userheader.ejs')  %> 
<!-- <div class="modal fade" id="Return" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <!- <div class="modal-dialog">
      <form id="return" method="post" onsubmit="ReturnOrder();return false">
        <div class="modal-content">
          <div class="modal-header">

            <h5 class="modal-title" id="exampleModalLabel">Return Product</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <label for="reviewId">Write Reason</label><br>
            <textarea name="reason" class="form-control" id="reviewId" cols="30" rows="4" required></textarea>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-success" data-bs-dismiss="modal">Close</button>
            <button class="btn btn-danger">Yes</button>
          </div>
      </form>
    </div> -->
  <!-- </div>
  </div> --> -->

  <div class="page-holder">
    <div class="container">
      <!-- HERO SECTION-->
      <section class="py-5 bg-light">
        <div class="container">
          <div class="row px-4 px-lg-5 py-lg-4 align-items-center">
            <div class="col-lg-6">
              <h1 class="h2 text-uppercase mb-0">View details</h1>
            </div>
            <!-- <div class="col-lg-6 text-lg-end">
              <nav aria-label="breadcrumb">
                <ol class="breadcrumb justify-content-lg-end mb-0 px-0 bg-light">
                  <li class="breadcrumb-item"><a class="text-dark" href="/">Home</a></li>
                  <li class="breadcrumb-item"><a class="text-dark" href="/orderDetails">Order history</a></li>
                  <li class="breadcrumb-item active" aria-current="page">View details</li>
                </ol>
              </nav>
            </div> -->
          </div>
        </div>
      </section>

      <div class="page-content">

        <div class="widget-content widget-content-area add-manage-product-2 container mt-3">
          <div class="row ">


            <div class="col-md-2 ">
              <div class="card card-default " style="border-color: white !important; color: black !important;">

                <div class="card border-0 ad-box-shadow p-0 ">

                  <div class="card-body col-sm-112">



                    <div id="dragged_images">
                    </div>
                    <div class=" d-flex justify-content-center mt-4">
                      <!-- <div class=" ">
                        <a class="btn btn-sm btn-block d-flex align-items-center justify-content-center text-light" href="/account" style="background-color: rgb(63, 63, 63)">Account</a>
                        <a class="btn btn-sm btn-block  d-flex align-items-center justify-content-center px-0 text-light mt-3" href="" style="background-color: rgb(63, 63, 63)">Change Password</a>
                        <a class="btn btn-sm btn-block  d-flex align-items-center justify-content-center px-0 text-light mt-3" href="/orderDetails" style="background-color: rgb(63, 63, 63)">Order Details</a>

                      </div> -->
                    </div>

                  </div>
                </div>
              </div>
            </div>
            <div class=" col-md-10 ">

              <div class="admincard card card-default" style="border-color: white !important;">

                <div class="card-body ">
                  <div class="card-body d-flex">
                    <div class="card p-3 bg-light my-2 col-lg-6" id="item">
                      <div class="d-flex justify-content-between">
                        <h6>Address </h6>
                      </div>
                      <div class="col-md-4">
                        <p><b><%=orderDetails.address.name %></b>,&nbsp;<%=orderDetails.address.house +', '+ orderDetails.address.post +', ' +orderDetails.address.pin %> <br><%=  orderDetails.address.city +',' +orderDetails.address.district+', '+orderDetails.address.state %></p>
                      </div>
                    </div>
                    <div class="card p-3 bg-light my-2 col-lg-6 text-center" id="item">
                      <div class="d-flex justify-content-center">
                        <h6 class="fw-bold text-success">Coupon Details</h6>
                      </div>
                      <div class="text-center ">
                        <% if(orderDetails.coupon.discount>0){ %>
                         
                        
                        <p>Coupon code: <%=orderDetails.coupon.code %></p>
                        <p>Discount:<%=orderDetails.coupon.discount %></p>
                        <p>Total Amount:<%=orderDetails.bill_amount-(orderDetails.bill_amount*orderDetails.coupon.discount)/100 %></p>
                        
                        <% }else{ %>
                        <h3 class="mt-4">No Coupon Applied</h3>
                        <% } %>
                      </div>
                    </div>
                  </div>

                  <div class="card-body ">


                    <div class="table-responsive mb-4 border border-2 border-black">
                      <table class="table text-nowrap">
                        <thead class="bg-light">
                          <tr>
                            <th class="border-0 p-3 ps-5" scope="col"> <strong class="text-sm text-uppercase">Product</strong></th>
                            <th class="border-0 p-3" scope="col"> <strong class="text-sm text-uppercase">Name</strong></th>
                            <th class="border-0 p-3" scope="col"> <strong class="text-sm text-uppercase">Quantity</strong></th>
                            <th class="border-0 p-3" scope="col"> <strong class="text-sm text-uppercase">Price</strong></th>
                            <th class="border-0 p-3 text-center" scope="col"> <strong class="text-sm text-uppercase">Total</strong></th>
                            <% if(orderDetails.delivery_status.delivered.state==true){ %>
                            <!-- <th class="border-0 p-3 text-center" scope="col"> <strong class="text-sm text-uppercase">Review</strong></th> -->
                            <% } %>

                          </tr>
                        </thead>
                        <tbody class="border-0">

                           <% orderDetails.productt.forEach((val)=>{ %>
                          <!-- <tr id="< %= val._id %>item"> -->
                            <th class="ps-0 py-3 border-light ps-5" scope="row">
                              <div class="d-flex align-items-center "><a class="reset-anchor d-block animsition-link " href="<%= val.product_id._id %>"><img src="<%=val.product_id.image[0] %>" alt="ProductDetials" width="70" /></a>
                              </div>
                            </th>
                            <th class="ps-0 py-3 border-light align-middle" scope="row">
                              <!-- <div class="ms-3"><strong class="h6"><a class="reset-anchor animsition-link" href="/productdetials/< %= val.product_id._id %>/< %= val.product_id.brand %>"> -->
                                    <%= val.name %>
                                  </a></strong></div>
                            </th>
                            <td class="p-3 align-middle border-light">
                              <p class="mb-0 small"><span>
                                  <%= val.qnty %>
                                </span></p>
                            </td>
                            <td class="p-3 align-middle border-light">
                              <p class="mb-0 small"><i class="bi bi-currency-rupee"></i><span>
                                  <%= val.product_id.price %>
                                </span></p>
                            </td>
                            <td class="p-3 align-middle border-light ps-5">

                              <p class="mb-0 small"><i class="bi bi-currency-rupee"></i><span>
                                  <%= val.price %>
                                </span></p>
                            </td>
                            <% if(orderDetails.delivery_status.delivered.state==true){ %> 
                            <!-- <td class="p-3 align-middle border-light">
                              <button type="button " class="badge " data-bs-toggle="modal" data-bs-target="#exampleModalre" onclick="review()">
                                <i class="bi bi-stars text-warning"></i>
                              </button>

                            </td> -->

                            <% } %>

                          </tr>
                          <% }) %>

                        </tbody>
                      </table>
                    </div>


                  </div>
                   <%  if(orderDetails.delivery_status.canceled.state==true){ %>


                  <h5 class="text-danger text-center border border-danger">cancelled</h5>

                  <% }else{%>
                  <div id="cancel" class="text-end me-3">
                    <!-- Button trigger modal -->
                    <button type="button" class="btn  bg-danger rounded" onclick="cancelOrder('<%=orderDetails._id%>')">
                      Cancel Order
                    </button>
                  </div>
                  <% } %>
                 
                          
                    

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

 

<script>
  function cancelOrder(id) {
    console.log(id);
  $.ajax({
    type: "POST",
    url: "/cancelOrder",
    data: {
      id,
    },
    dataType: "json",
    encode: true,
  }).done(function (data) {
    if (data == "Ordercanceled") {
      Swal.fire("Canceled", "This Order has been cancelled.", "success");
      resHTML =
        '<h5 class="text-danger text-center border border-danger">Order Cancelled</h5>';
      $("#cancel").html(resHTML);
    }
  });
}
</script>




<%-include('../user/layout/userfooter.ejs')  %> 